(function(){function require(path,parent,orig){var resolved=require.resolve(path);if(null==resolved){orig=orig||path;parent=parent||"root";var err=new Error('Failed to require "'+orig+'" from "'+parent+'"');err.path=orig;err.parent=parent;err.require=true;throw err}var module=require.modules[resolved];if(!module._resolving&&!module.exports){var mod={};mod.exports={};mod.client=mod.component=true;module._resolving=true;module.call(this,mod.exports,require.relative(resolved),mod);delete module._resolving;module.exports=mod.exports}return module.exports}require.modules={};require.aliases={};require.resolve=function(path){if(path.charAt(0)==="/")path=path.slice(1);var paths=[path,path+".js",path+".json",path+"/index.js",path+"/index.json"];for(var i=0;i<paths.length;i++){var path=paths[i];if(require.modules.hasOwnProperty(path))return path;if(require.aliases.hasOwnProperty(path))return require.aliases[path]}};require.normalize=function(curr,path){var segs=[];if("."!=path.charAt(0))return path;curr=curr.split("/");path=path.split("/");for(var i=0;i<path.length;++i){if(".."==path[i]){curr.pop()}else if("."!=path[i]&&""!=path[i]){segs.push(path[i])}}return curr.concat(segs).join("/")};require.register=function(path,definition){require.modules[path]=definition};require.alias=function(from,to){if(!require.modules.hasOwnProperty(from)){throw new Error('Failed to alias "'+from+'", it does not exist')}require.aliases[to]=from};require.relative=function(parent){var p=require.normalize(parent,"..");function lastIndexOf(arr,obj){var i=arr.length;while(i--){if(arr[i]===obj)return i}return-1}function localRequire(path){var resolved=localRequire.resolve(path);return require(resolved,parent,path)}localRequire.resolve=function(path){var c=path.charAt(0);if("/"==c)return path.slice(1);if("."==c)return require.normalize(p,path);var segs=parent.split("/");var i=lastIndexOf(segs,"deps")+1;if(!i)i=0;path=segs.slice(0,i+1).join("/")+"/deps/"+path;return path};localRequire.exists=function(path){return require.modules.hasOwnProperty(localRequire.resolve(path))};return localRequire};require.register("visionmedia-debug/debug.js",function(exports,require,module){module.exports=debug;function debug(name){if(!debug.enabled(name))return function(){};return function(fmt){fmt=coerce(fmt);var curr=new Date;var ms=curr-(debug[name]||curr);debug[name]=curr;fmt=name+" "+fmt+" +"+debug.humanize(ms);window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}}debug.names=[];debug.skips=[];debug.enable=function(name){try{localStorage.debug=name}catch(e){}var split=(name||"").split(/[\s,]+/),len=split.length;for(var i=0;i<len;i++){name=split[i].replace("*",".*?");if(name[0]==="-"){debug.skips.push(new RegExp("^"+name.substr(1)+"$"))}else{debug.names.push(new RegExp("^"+name+"$"))}}};debug.disable=function(){debug.enable("")};debug.humanize=function(ms){var sec=1e3,min=60*1e3,hour=60*min;if(ms>=hour)return(ms/hour).toFixed(1)+"h";if(ms>=min)return(ms/min).toFixed(1)+"m";if(ms>=sec)return(ms/sec|0)+"s";return ms+"ms"};debug.enabled=function(name){for(var i=0,len=debug.skips.length;i<len;i++){if(debug.skips[i].test(name)){return false}}for(var i=0,len=debug.names.length;i<len;i++){if(debug.names[i].test(name)){return true}}return false};function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}try{if(window.localStorage)debug.enable(localStorage.debug)}catch(e){}});require.register("component-indexof/index.js",function(exports,require,module){module.exports=function(arr,obj){if(arr.indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i){if(arr[i]===obj)return i}return-1}});require.register("learnboost-jsonp/index.js",function(exports,require,module){var debug=require("debug")("jsonp");var indexof=require("indexof");module.exports=jsonp;var count=0;function noop(){}function jsonp(url,opts,fn){if("function"==typeof opts){fn=opts;opts={}}if(!opts)opts={};var param=opts.param||"callback";var timeout=null!=opts.timeout?opts.timeout:6e4;var enc=encodeURIComponent;var target=document.getElementsByTagName("script")[0]||document.head;var script;var timer;var id=count++;if(timeout){timer=setTimeout(function(){cleanup();if(fn)fn(new Error("Timeout"))},timeout)}function cleanup(){script.parentNode.removeChild(script);window["__jp"+id]=noop}window["__jp"+id]=function(data){debug("jsonp got",data);if(timer)clearTimeout(timer);cleanup();if(fn)fn(null,data)};url+=(~indexof(url,"?")?"&":"?")+param+"="+enc("__jp"+id+"");url=url.replace("?&","?");debug('jsonp req "%s"',url);script=document.createElement("script");script.src=url;target.parentNode.insertBefore(script,target)}});require.register("component-json-fallback/index.js",function(exports,require,module){if(typeof JSON!=="object"){JSON={}}(function(){"use strict";function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var cx,escapable,gap,indent,meta,rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;meta={"\b":"\\b"," ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else if(typeof space==="string"){indent=space}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}})();module.exports=JSON});require.register("request/index.js",function(exports,require,module){if("undefined"==typeof window){module.exports=require("superagent")}else{module.exports=require("./lib/request")}});require.register("request/lib/request.js",function(exports,require,module){var jsonp=require("jsonp");var debug=require("debug")("tickets:request");var json=require("./json");function request(method,url){return new Request(method,url)}request.get=function(url){return request("GET",url)};request.post=function(url){return request("POST",url)};function Request(method,url){debug("request %s to %s",method,url);this.url=url;this.send("_method",method)}Request.prototype.send=function(key,data){debug("add data to request");if(arguments.length==1)data=key;else data={key:data};this.data=serialize(data);return this};Request.prototype.end=function(fn){debug("send request");this.url=this.url+"?"+this.data;jsonp(this.url,function(err,data){if(typeof data=="string")data={body:data};data=data||{};data.ok=!err;debug("request %s",data.ok?"succeed":"failed");fn(data)})};module.exports=request;function serialize(data){return"data="+encodeURIComponent(json.stringify(data))}});require.register("request/lib/json.js",function(exports,require,module){module.exports="undefined"==typeof JSON?require("json-fallback"):JSON});require.register("log/index.js",function(exports,require,module){var request=require("request");var debug=require("debug")("tickets:log");function Log(options){options=options||{};this.buffer=[];this.flushInterval=options.flushInterval||5e3;this.url=options.url||"/log"}Log.prototype.write=function(level,type,obj){debug("%s: %s",level,type);this.buffer.push([level,type,obj]);return this};Log.prototype.info=function(type,obj){this.write("info",type,obj);return this};Log.prototype.warn=function(type,obj){this.write("warn",type,obj);return this};Log.prototype.error=function(type,obj){this.write("error",type,obj);return this};Log.prototype.start=function(){debug("flush interval start");var self=this;this._id=setInterval(function(){self.flush.call(self)},this.flushInterval);return this};Log.prototype.stop=function(){debug("flush interval stop");clearInterval(this._id);return this};Log.prototype.clear=function(){debug("buffer clear");this.buffer=[];return this};Log.prototype.flush=function(){var self=this;var buf=this.buffer;if(!buf.length)return;debug("flushing %d log entries",buf.length);request.post(this.url).send(buf).end(function(res){if(res.ok){debug("flush complete");self.clear()}else{debug("flush failed")}})};module.exports=new Log;Error.prototype.toJSON=function(){return{message:this.message,stack:this.stack}}});require.register("log-error/index.js",function(exports,require,module){module.exports=function(log,type){window.onerror=function(msg,url,line){log.error(type,{message:msg,url:url,line:line})}}});require.register("component-trim/index.js",function(exports,require,module){exports=module.exports=trim;function trim(str){if(str.trim)return str.trim();return str.replace(/^\s*|\s*$/g,"")}exports.left=function(str){if(str.trimLeft)return str.trimLeft();return str.replace(/^\s*/,"")};exports.right=function(str){if(str.trimRight)return str.trimRight();return str.replace(/\s*$/,"")}});require.register("component-querystring/index.js",function(exports,require,module){var trim=require("trim");exports.parse=function(str){if("string"!=typeof str)return{};str=trim(str);if(""==str)return{};if("?"==str.charAt(0))str=str.slice(1);var obj={};var pairs=str.split("&");for(var i=0;i<pairs.length;i++){var parts=pairs[i].split("=");obj[parts[0]]=null==parts[1]?"":decodeURIComponent(parts[1])}return obj};exports.stringify=function(obj){if(!obj)return"";var pairs=[];for(var key in obj){pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(obj[key]))}return pairs.join("&")}});require.register("component-event/index.js",function(exports,require,module){var bind=window.addEventListener?"addEventListener":"attachEvent",unbind=window.removeEventListener?"removeEventListener":"detachEvent",prefix=bind!=="addEventListener"?"on":"";exports.bind=function(el,type,fn,capture){el[bind](prefix+type,fn,capture||false);return fn};exports.unbind=function(el,type,fn,capture){el[unbind](prefix+type,fn,capture||false);return fn}});require.register("modal/index.js",function(exports,require,module){var events=require("event"),utils=require("./utils");module.exports=Modal;function Modal(opts){if(!(this instanceof Modal))return new Modal;this.loads=0}Modal.prototype.setTemplate=function(data){this.html=data.html;this.card_type=data.card_type;this.gateway=data.gateway};Modal.prototype.insertTemplate=function(){var div=this.main_div=document.createElement("div");div.innerHTML=this.html;utils.hide(div)};Modal.prototype.bindEvents=function(){var self=this;events.bind(this.main_div.getElementsByTagName("a")[0],"click",function(){self.hide(function(){self.cb=null;var err=new Error("The user closed the modal.");self.fn&&self.fn(err);self.remove()});return false});events.bind(this.main_div.getElementsByTagName("iframe")[0],"load",function(){if(++self.loads===2&&self.gateway==="nps"){self.endTransaction()}else if(self.loads===2&&self.gateway==="decidir"&&self.card_type==="visa"){self.endTransaction()}else if(self.loads===3&&self.gateway==="decidir"&&self.card_type==="mastercard"){self.endTransaction()}return false})};Modal.prototype.endTransaction=function(){this.hideIframe();this.cb&&this.cb();this.cb=this;this.remove()};Modal.prototype.show=function(){var self=this;this.insertTemplate();this.bindEvents();document.body.appendChild(this.main_div);utils.fadeIn(this.main_div)};Modal.prototype.hide=function(fn){utils.fadeOut(this.main_div,fn)};Modal.prototype.hideIframe=function(){var iframe=this.main_div.getElementsByTagName("iframe")[0];if(iframe){var iframe_holder=iframe.parentNode;iframe_holder.className+=" ticketsPaymentModal-iframe-hidden"}};Modal.prototype.remove=function(){var self=this;utils.fadeOut(this.main_div,function(){if(self.main_div.parentNode){self.main_div.parentNode.removeChild(self.main_div)}self.main_div=null})};Modal.prototype.isLoaded=function(){return!!this.html}});require.register("modal/utils.js",function(exports,require,module){var test_el=document.createElement("a");test_el.style.cssText="opacity:.5";var support_opacity=/^0.5/.test(test_el.style.opacity);var getOpacity=function(div){return parseFloat(div.style.opacity)};var setOpacity=function(div,val){div.style.opacity=val};var fadeIn=exports.fadeIn=function(div){if(!support_opacity)return div.style.display="block";var op=getOpacity(div);setOpacity(div,op+.1);if(op+.1<1){setTimeout(function(){fadeIn(div)},25)}};var fadeOut=exports.fadeOut=function(div,fn){if(!support_opacity){if(div.tagName==="IFRAME"){div.style.width="0px";div.style.height="0px";div.style.border="0px"}else{div.style.display="none"}fn&&fn()}else{var op=getOpacity(div);setOpacity(div,op-.1);if(op-.1>.1){setTimeout(function(){fadeOut(div,fn)},25)}else{setOpacity(div,0);fn&&fn()}}};exports.hide=function(div){if(!support_opacity)return div.style.display="none";setOpacity(div,0)}});require.register("config/index.js",function(exports,require,module){module.exports={base_url:"/",payments_url:"https://checkout.jsconfar.com/services/modal/template/",log_url:"https://checkout.jsconfar.com/services/log",authorization_url:"https://checkout.jsconfar.com/api/v0/authorizations/",interest_url:"https://checkout.jsconfar.com/services/installments"}});require.register("core/index.js",function(exports,require,module){var config=require("config"),jsonp=require("jsonp"),modal=require("modal"),log=require("log"),qs=require("querystring"),utils=require("./utils");log.url=config.log_url;require("log-error")(log,"tickets");log.start();function noop(){}module.exports=JsConfPayments;function JsConfPayments(opts,fn){if(!(this instanceof JsConfPayments))return new JsConfPayments(opts,fn);if("object"!=typeof opts)throw new Error("Please provide credentials");if("string"!=typeof opts.authorization_uid)throw new Error("Please provide a authorization_uid");if("string"!=typeof opts.api_key)throw new Error("Please provide a public api_key");this.authorization_uid=opts.authorization_uid;this.api_key=opts.api_key;this.modal=modal();this.loadTemplate(fn);log.info("tickets",'fetch modal with authorization_uid "'+this.authorization_uid+'"')}JsConfPayments.prototype.loadTemplate=function(fn){request.call(this,config.payments_url+this.authorization_uid,null,function(err,data){if(data)this.modal.setTemplate(data);this.gateway=data.gateway;fn.call(this,err)});log.info("tickets","Requested interests");return this};JsConfPayments.prototype.charge=function(fn,confirm){var self=this;this.modal.fn=fn;if(!this.modal.isLoaded()){log.error("tickets.charge","Can't create a charge with authorization_uid: "+this.authorization_uid);fn(new Error("Either your authorization_uid "+this.authorization_uid+" is invalid or there was a problem with the server."))}else{this.modal.show();this.confirm=confirm!==false?true:false;if(this.confirm){if(this.gateway==="decidir"){this.retries=0;this.modal.cb=this.confirmWithBackoff(fn)}else{this.modal.cb=getConfirmation.call(this,fn)}}else if(fn){this.modal.cb=this.modal.fn}else{this.modal.cb=noop}log.info("tickets",'modal opened for charge with authorization_uid "'+this.authorization_uid+'"')}};var backoff_timeout=[0,1e3,2e3];JsConfPayments.prototype.confirmWithBackoff=function(fn){var self=this;return function(){if(this.retries>2){return fn(new Error("Charge not created after 3 retries"))}var confirmation=getConfirmation.call(self,function(err,data){if(data&&data.success&&data.success!==true){self.retries++;self.confirmWithBackoff(fn)}else{fn(err,data)}});setTimeout(confirmation,backoff_timeout[this.retries])}};JsConfPayments.getInterest=function(options,fn){request.call(JsConfPayments,config.interest_url,options,fn);log.info("tickets","Requested interests");return this};function getConfirmation(fn){var self=this;return function(){request.call(self,config.authorization_url+self.authorization_uid+"/",{api_key:self.api_key},fn)}}function request(url,options,fn){var self=this;fn=fn||noop;var data=options?"?"+qs.stringify(options):"";jsonp(url+data,function(err,data){if(err){log.error("tickets.request","Request to "+url+" failed.");fn.call(self,new Error("Request failed."),null)}else if(data.error){fn.call(self,new Error(data.error),null)}else{fn.call(self,null,data)}})}});require.register("core/utils.js",function(exports,require,module){var config=require("config");exports.loadStylesheet=function(url){var scripts=document.getElementsByTagName("script");var script_node=scripts[scripts.length-1];var style_link=document.createElement("link");style_link.rel="stylesheet";style_link.type="text/css";style_link.href=url;script_node.parentNode.insertBefore(style_link,script_node)};exports.loadConditionalCss=function(){var conditional=document.createElement("div"),conditional_i=conditional.getElementsByTagName("i");conditional.innerHTML="<!--[if lte IE 8]><i></i><![endif]-->";if(conditional_i[0])exports.loadStylesheet(config.base_url+"ie.css")}});require.register("JsConfPayments/index.js",function(exports,require,module){module.exports=require("core")});require.alias("core/index.js","JsConfPayments/deps/core/index.js");require.alias("core/utils.js","JsConfPayments/deps/core/utils.js");require.alias("core/index.js","JsConfPayments/deps/core/index.js");require.alias("core/index.js","core/index.js");require.alias("learnboost-jsonp/index.js","core/deps/jsonp/index.js");require.alias("learnboost-jsonp/index.js","core/deps/jsonp/index.js");require.alias("visionmedia-debug/debug.js","learnboost-jsonp/deps/debug/debug.js");require.alias("visionmedia-debug/debug.js","learnboost-jsonp/deps/debug/index.js");require.alias("visionmedia-debug/debug.js","visionmedia-debug/index.js");require.alias("component-indexof/index.js","learnboost-jsonp/deps/indexof/index.js");require.alias("learnboost-jsonp/index.js","learnboost-jsonp/index.js");require.alias("log/index.js","core/deps/log/index.js");require.alias("log/index.js","core/deps/log/index.js");require.alias("visionmedia-debug/debug.js","log/deps/debug/debug.js");require.alias("visionmedia-debug/debug.js","log/deps/debug/index.js");require.alias("visionmedia-debug/debug.js","visionmedia-debug/index.js");require.alias("request/index.js","log/deps/request/index.js");require.alias("request/lib/request.js","log/deps/request/lib/request.js");require.alias("request/lib/json.js","log/deps/request/lib/json.js");require.alias("request/index.js","log/deps/request/index.js");require.alias("learnboost-jsonp/index.js","request/deps/jsonp/index.js");require.alias("learnboost-jsonp/index.js","request/deps/jsonp/index.js");require.alias("visionmedia-debug/debug.js","learnboost-jsonp/deps/debug/debug.js");require.alias("visionmedia-debug/debug.js","learnboost-jsonp/deps/debug/index.js");require.alias("visionmedia-debug/debug.js","visionmedia-debug/index.js");require.alias("component-indexof/index.js","learnboost-jsonp/deps/indexof/index.js");require.alias("learnboost-jsonp/index.js","learnboost-jsonp/index.js");require.alias("visionmedia-debug/debug.js","request/deps/debug/debug.js");require.alias("visionmedia-debug/debug.js","request/deps/debug/index.js");require.alias("visionmedia-debug/debug.js","visionmedia-debug/index.js");require.alias("component-json-fallback/index.js","request/deps/json-fallback/index.js");require.alias("request/index.js","request/index.js");require.alias("log/index.js","log/index.js");require.alias("log-error/index.js","core/deps/log-error/index.js");require.alias("log-error/index.js","core/deps/log-error/index.js");require.alias("log-error/index.js","log-error/index.js");require.alias("component-querystring/index.js","core/deps/querystring/index.js");require.alias("component-trim/index.js","component-querystring/deps/trim/index.js");require.alias("modal/index.js","core/deps/modal/index.js");require.alias("modal/utils.js","core/deps/modal/utils.js");require.alias("modal/index.js","core/deps/modal/index.js");require.alias("component-event/index.js","modal/deps/event/index.js");require.alias("modal/index.js","modal/index.js");require.alias("config/index.js","core/deps/config/index.js");require.alias("config/index.js","core/deps/config/index.js");require.alias("config/index.js","config/index.js");require.alias("core/index.js","core/index.js");window.JsConfPayments=require("JsConfPayments")})();